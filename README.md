# Shell Emulator

Эмулятор командной оболочки (shell) на Python, реализующий основные команды для работы с файловой системой, архивами и поиска по содержимому файлов.

## Описание

Проект представляет собой интерактивный эмулятор командной оболочки, поддерживающий набор стандартных команд для навигации по файловой системе, управления файлами и директориями, работы с архивами, а также поиска по содержимому файлов. Эмулятор включает систему логирования операций, историю команд с возможностью отмены последних действий и механизм безопасного удаления файлов через корзину.

## Требования

- Python 3.10 или выше
- Стандартная библиотека Python (os, shutil, stat, zipfile, tarfile, re, logging)

## Установка

1. Клонируйте репозиторий или скачайте исходный код проекта.

2. Установите зависимости для разработки (опционально):
```bash
pip install -e ".[dev]"
```

Или установите зависимости напрямую:
```bash
pip install pytest==8.4.2 mypy==1.18.2 ruff==0.14.3 pre-commit==4.3.0
```

## Запуск

Для запуска эмулятора выполните:

```bash
python -m src.main
```

После запуска вы увидите приветственное сообщение и приглашение командной строки в формате `<текущая_директория>>`.

## Команды

### Команды файловой системы

#### `ls [путь] [-l]`
Выводит список файлов и директорий в указанной директории. Если путь не указан, используется текущая директория.

**Опции:**
- `-l` — подробный вывод с информацией о размере, дате изменения и правах доступа

**Примеры:**
```
ls
ls /home/user
ls -l
ls Documents -l
```

#### `cd <путь>`
Изменяет текущую рабочую директорию на указанный путь.

**Примеры:**
```
cd /home/user
cd Documents
cd ..
cd ~
```

#### `pwd`
Выводит абсолютный путь к текущей рабочей директории.

#### `cat <файл>`
Выводит содержимое указанного файла.

**Пример:**
```
cat file.txt
cat /path/to/file.txt
```

#### `cp <источник> <назначение> [-r]`
Копирует файл или директорию из источника в назначение.

**Опции:**
- `-r` — рекурсивное копирование директорий (обязательно для копирования директорий)

**Примеры:**
```
cp file.txt backup.txt
cp -r folder backup_folder
```

#### `mv <источник> <назначение>`
Перемещает или переименовывает файл или директорию.

**Примеры:**
```
mv old_name.txt new_name.txt
mv file.txt /path/to/destination/
```

#### `rm <путь> [-r]`
Удаляет файл или директорию. Удалённые объекты перемещаются в корзину (`.trash`), что позволяет восстановить их при необходимости.

**Опции:**
- `-r` — рекурсивное удаление директорий (обязательно для удаления директорий)

**Примечание:** При удалении директорий требуется подтверждение действия.

**Примеры:**
```
rm file.txt
rm -r directory
```

### Команды работы с архивами

#### `zip <папка> <имя_архива>`
Создаёт ZIP-архив из указанной папки или файла.

**Примеры:**
```
zip my_folder archive.zip
zip file.txt archive.zip
```

#### `unzip <архив>`
Распаковывает ZIP-архив в текущую директорию.

**Пример:**
```
unzip archive.zip
```

#### `tar <папка> <имя_архива>`
Создаёт TAR.GZ-архив из указанной папки.

**Пример:**
```
tar my_folder archive.tar.gz
```

#### `untar <архив>`
Распаковывает TAR.GZ-архив в текущую директорию.

**Пример:**
```
untar archive.tar.gz
```

### Продвинутые команды

#### `grep <шаблон> <путь> [-r] [-i]`
Выполняет поиск указанного шаблона в файлах. Поддерживает регулярные выражения.

**Опции:**
- `-r` — рекурсивный поиск в поддиректориях
- `-i` — игнорирование регистра при поиске

**Примеры:**
```
grep "pattern" file.txt
grep "error" /path/to/logs -r
grep "ERROR" logs -r -i
```

#### `history`
Выводит историю последних выполненных команд (до 100 команд).

#### `undo`
Отменяет последнюю операцию, которая может быть отменена. Поддерживаются операции:
- `cp` — удаляет скопированный файл или директорию
- `mv` — возвращает перемещённый файл или директорию на исходное место
- `rm` — восстанавливает удалённый файл или директорию из корзины

**Примечание:** Команды `history` и `undo` не добавляются в историю команд.

### Служебные команды

#### `exit`
Завершает работу эмулятора.

## Структура проекта

```
shell/
├── src/
│   ├── __init__.py
│   ├── main.py              # Точка входа
│   ├── shell.py             # Основной класс Shell
│   ├── logger.py            # Модуль логирования
│   ├── constants.py         # Константы проекта
│   └── commands/
│       ├── __init__.py
│       ├── base.py          # Базовый класс команд
│       ├── filesystem.py    # Команды файловой системы
│       ├── archive.py       # Команды работы с архивами
│       └── advanced.py      # Продвинутые команды
├── tests/                   # Тесты
│   ├── conftest.py          # Конфигурация pytest
│   └── test_*.py            # Тесты для каждой команды
├── pyproject.toml           # Конфигурация проекта
├── requirements.txt         # Зависимости
└── README.md
```

## Логирование

Все операции эмулятора логируются в файл `shell.log` в текущей директории. В лог записываются:
- Выполненные команды
- Успешные операции
- Ошибки выполнения

Формат логов: `[YYYY-MM-DD HH:MM:SS] MESSAGE`

## История команд

История команд сохраняется в файле `.history` в текущей директории. История ограничена 100 последними командами. История загружается автоматически при запуске эмулятора и сохраняется после каждой команды.

## Корзина

Удалённые файлы и директории перемещаются в директорию `.trash` в текущей рабочей директории, а не удаляются безвозвратно. Это позволяет восстановить их с помощью команды `undo`. При удалении файла с уже существующим именем в корзине к имени добавляется временная метка.

## Тестирование

Проект включает набор unit-тестов и integration-тестов для всех команд. Для запуска тестов используйте:

```bash
pytest
```

Для запуска с подробным выводом:

```bash
pytest -v
```

Тесты используют временные директории, создаваемые автоматически, и не влияют на реальную файловую систему.

## Проверка кода

Проект использует следующие инструменты для проверки качества кода:

- **mypy** — проверка типов
- **ruff** — линтер и форматтер кода
- **pytest** — фреймворк для тестирования

Для проверки типов:
```bash
mypy src/
```

Для проверки стиля кода:
```bash
ruff check src/
```

Для автоматического исправления проблем стиля:
```bash
ruff check --fix src/
```

## Особенности реализации

- Множественное наследование для организации команд по модулям
- Централизованное логирование всех операций
- Механизм отмены операций с поддержкой восстановления удалённых файлов
- Безопасное удаление через корзину
- Поддержка относительных и абсолютных путей
- Обработка специальных путей (`~`, `..`)
- Валидация входных данных и информативные сообщения об ошибках

## Ограничения

- Максимальный размер истории команд: 100 записей
- Логирование выполняется только в файл (без вывода в консоль)
- Команда `undo` работает только для операций `cp`, `mv` и `rm`
- При удалении директорий требуется интерактивное подтверждение

## Лицензия

Проект создан в рамках учебной программы.
